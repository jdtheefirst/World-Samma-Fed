"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[731],{80731:function(e,n,r){r.r(n),r.d(n,{default:function(){return b}});var t=r(90675),s=r(10467),o=r(5544),i=r(65043),c=r(60184),a=r(27787),u=r.n(a),l=(r(44050),r(58650),r(85522)),d=r(70579),f=function(e){var n=e.status,r=e.isConnected;return(0,d.jsx)(l.az,{p:2,borderRadius:"4px",bg:r?"green.500":"red.500",color:"white",children:n})},g=r(22107),h=r(76659),p=r(39081),m=r(28846),x=r(5371),v=r(38028),b=function(){var e=(0,i.useRef)(null),n=(0,i.useState)(null),r=(0,o.A)(n,2),a=r[0],l=r[1],b=(0,i.useState)(!1),j=(0,o.A)(b,2),y=j[0],w=j[1],S=(0,i.useState)(!1),A=(0,o.A)(S,2),k=A[0],C=A[1],z=(0,i.useRef)(null),R=(0,i.useRef)(null),E=(0,i.useRef)(null);(0,i.useEffect)((function(){return P(),function(){I()}}),[]);var P=function(){var n=(0,s.A)((0,t.A)().mark((function n(){var r;return(0,t.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{r=new(u())({server:"/ws/",success:function(){var e=(0,s.A)((0,t.A)().mark((function e(){var n,s;return(0,t.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.createSession();case 2:return n=e.sent,e.next=5,n.attachPlugin("janus.plugin.streaming");case 5:if(s=e.sent){e.next=8;break}throw new Error("Failed to attach streaming plugin");case 8:return console.log("Streaming plugin attached!"),l(s),C(!0),e.next=13,D(s);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),error:function(e){return console.error("Janus initialization error:",e)}}),e.current=r}catch(o){console.error("Error initializing Janus:",o)}case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),D=function(){var e=(0,s.A)((0,t.A)().mark((function e(n){var r;return(0,t.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:r=e.sent,z.current.srcObject=r,R.current=r,n.send({message:{request:"configure",audio:!0,video:!0}}),n.createOffer({media:{video:!0,audio:!0},stream:r,success:function(e){console.log("Generated JSEP:",e),n.send({message:{request:"start"},jsep:e})},error:function(e){console.error("Error creating WebRTC offer:",e),alert("An error occurred during streaming setup. Please try again.")}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error accessing user media:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(n){return e.apply(this,arguments)}}(),I=function(){e.current&&"function"===typeof e.current.destroy?(e.current.destroy(),console.log("Janus destroyed successfully")):console.error("Janus instance not found or destroy method missing"),E.current&&(E.current.close(),console.log("WebSocket connection closed"))};return(0,d.jsxs)(g.a,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",fontFamily:"Arial, sans-serif",color:"gray.800",children:[(0,d.jsxs)(g.a,{position:"relative",width:"80%",maxWidth:"720px",mb:5,bg:"black",borderRadius:"8px",overflow:"hidden",children:[(0,d.jsx)("video",{ref:z,autoPlay:!0,muted:!0,width:"100%",className:"video-feed"}),!k&&(0,d.jsxs)(g.a,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"rgba(0, 0, 0, 0.7)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",children:[(0,d.jsx)(h.y,{size:"lg"}),(0,d.jsx)(p.E,{ml:2,children:"Connecting..."})]})]}),(0,d.jsxs)(g.a,{textAlign:"center",width:"100%",maxWidth:"500px",children:[(0,d.jsx)(m.D,{as:"h2",size:"lg",mb:3,children:"Live Stream Control"}),(0,d.jsxs)(x.s,{justifyContent:"space-around",mb:3,children:[(0,d.jsx)(f,{status:k?"Connected":"Disconnected",isConnected:k}),(0,d.jsx)(f,{status:y?"Live":"Idle",isConnected:y})]}),(0,d.jsxs)(x.s,{justifyContent:"center",gap:3,children:[(0,d.jsx)(v.$,{leftIcon:(0,d.jsx)(c.gSK,{}),onClick:function(){if(a){a.send({message:{request:"publish",rtmp_url:"rtmp://nginx:1935/stream"},success:function(){console.log("Publishing to RTMP successfully!"),w(!0)},error:function(e){return console.error("Error publishing to RTMP:",e)}})}else console.error("RTMP plugin not attached.")},isDisabled:y||!k,colorScheme:"green",size:"lg",fontSize:"md",children:"Start Streaming"}),(0,d.jsx)(v.$,{leftIcon:(0,d.jsx)(c.wFo,{}),onClick:function(){a&&(a.hangup(),w(!1),R.current&&R.current.getTracks().forEach((function(e){return e.stop()})))},isDisabled:!y,colorScheme:"red",size:"lg",fontSize:"md",children:"Stop Streaming"})]})]})]})}}}]);
//# sourceMappingURL=731.a2ed2a53.chunk.js.map