"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[42],{53747:function(e,n,t){t.d(n,{ZU:function(){return m},bK:function(){return d},tJ:function(){return l},uS:function(){return f}});var r=t(90675),o=t(5544),s=t(10467),a=t(79722),c=t(65043),i=t(42104),u=t(97665),l=u.z.object({name:u.z.string().min(2,"Name must be at least 2 characters").max(50,"Name must be at most 50 characters"),otherName:u.z.string().min(2,"Other name must be at least 2 characters").max(50,"Other name must be at most 50 characters"),email:u.z.string().email("Invalid email address"),gender:u.z.enum(["male","female","other"]),password:u.z.string().min(4,"Password must be at least 8 characters long").max(100,"Password must be at most 100 characters"),confirmPassword:u.z.string().min(4,"Confirm password must be at least 8 characters long").max(100,"Confirm password must be at most 100 characters").refine((function(e,n){return e===n.parent.password}),{message:"Passwords do not match"}),passport:u.z.string().regex(/^\d{8,15}$/,"Invalid passport/ID number"),selectedCountry:u.z.string().min(2,"Country is required"),provinces:u.z.string().optional(),language:u.z.string().min(2,"Language is required"),pic:u.z.string().url("Profile picture is required")});function d(e){var n=(0,c.useState)(null),t=(0,o.A)(n,2),r=t[0],s=t[1],a=(0,c.useRef)(null);return(0,c.useEffect)((function(){if(e&&e.token){if(!a.current){var n=e._id,t=(0,i.io)("/",{query:{token:e.token,userId:n}});return t.on("connect",(function(){console.log("connected"),s(t)})),t.on("disconnect",(function(e){console.log("Socket.IO disconnected due to:",e),"io server disconnect"===e&&t.connect()})),t.on("reconnect_attempt",(function(e){console.log("Reconnection attempt ".concat(e))})),t.on("error",(function(e){console.error("Socket.IO error:",e)})),a.current=t,function(){t&&t.disconnect(),a.current=null}}s(a.current)}}),[e]),r}function m(e,n,t,r){return p.apply(this,arguments)}function p(){return(p=(0,s.A)((0,r.A)().mark((function e(n,t,o,s){var c,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,c={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(o.token)}},e.next=6,a.A.post("/api/paycheck/makepaymentmpesa/".concat(o._id,"?amount=").concat(n),{phoneNumber:t},c);case 6:i=e.sent,i.data&&s({title:"You have been prompt to finish your subscription process",status:"info",duration:1e3,position:"bottom"}),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}function f(e,n,t){return h.apply(this,arguments)}function h(){return(h=(0,s.A)((0,r.A)().mark((function e(n,t,o){var s,c;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,s={headers:{"Content-type":"application/json"}},e.next=6,a.A.post("/api/paycheck/donationsmpesa?amount=".concat(n),{phoneNumber:t},s);case 6:c=e.sent,c.data&&o({title:"You have been prompt to finish your subscription process",status:"info",duration:1e3,position:"bottom"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}},35042:function(e,n,t){t.r(n);var r=t(90675),o=t(10467),s=t(5544),a=t(65043),c=(t(58650),t(60184)),i=t(53747),u=t(56818),l=t(70579);n.default=function(){var e=(0,a.useState)(!1),n=(0,s.A)(e,2),t=n[0],d=n[1],m=(0,a.useState)(!1),p=(0,s.A)(m,2),f=p[0],h=(p[1],(0,a.useRef)(null)),g=(0,u.a)().user,v=(0,i.bK)(g),b=(0,a.useState)(!1),k=(0,s.A)(b,2),x=k[0],j=k[1],S=(0,a.useRef)(null),w=new WebSocket("ws://167.99.44.195:8188");w.onopen=function(){console.log("Connected to Janus WebSocket server"),v.send(JSON.stringify({janus:"attach",plugin:"janus.plugin.rtmp"}))},w.onmessage=function(e){var n=JSON.parse(e.data);console.log("Received message from Janus:",n)},w.onerror=function(e){console.error("WebSocket error:",e)},w.onclose=function(){console.log("WebSocket connection closed")},(0,a.useEffect)((function(){if(v)return j(v.connected),v.on("connect",(function(){return j(!0)})),v.on("disconnect",(function(){return j(!1)})),v.on("stream-started",(function(e){console.log("Streaming started:",e),N()})),v.on("stream-stopped",(function(){console.log("Streaming stopped"),d(!1)})),v.on("error",(function(e){console.error("Socket.IO error:",e)})),function(){v.off("stream-started"),v.off("stream-stopped"),v.off("error")}}),[v]);var y=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var n;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:n=e.sent,S.current=n,h.current.srcObject=n,v.emit("start-stream",{streamId:"your-stream-id"}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error starting stream:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),N=function(){S.current&&janusInstance.attach({plugin:"janus.plugin.rtmp",success:function(e){e.createOffer({media:{video:S.current.getVideoTracks()[0],audio:S.current.getAudioTracks()[0]},success:function(n){e.send({message:{request:"publish",rtmp:"rtmp://janus:8188/stream"},jsep:n}),d(!0)},error:function(e){console.error("Error creating SDP offer:",e)}})},error:function(e){console.error("Error attaching RTMP plugin:",e)}})};return(0,l.jsxs)("div",{className:"streaming-container",children:[(0,l.jsxs)("div",{className:"video-wrapper",children:[(0,l.jsx)("video",{ref:h,autoPlay:!0,muted:!0,className:"video-feed"}),!f&&(0,l.jsx)("div",{className:"overlay",children:"Connecting..."})]}),(0,l.jsxs)("div",{className:"control-panel",children:[(0,l.jsx)("h2",{children:"Live Stream Control"}),(0,l.jsxs)("div",{className:"status-indicators",children:[(0,l.jsx)("div",{className:"status ".concat(f?"connected":"disconnected"),children:f?"Connected":"Disconnected"}),(0,l.jsx)("div",{className:"status ".concat(t?"live":"idle"),children:t?"Live":"Idle"})]}),(0,l.jsxs)("div",{className:"controls",children:[(0,l.jsxs)("button",{onClick:y,disabled:t||!x,className:"start-btn",children:[(0,l.jsx)(c.gSK,{})," Start Streaming"]}),(0,l.jsxs)("button",{onClick:function(){v.emit("stop-stream",{streamId:"your-stream-id"}),d(!1)},disabled:!t,className:"stop-btn",children:[(0,l.jsx)(c.wFo,{})," Stop Streaming"]})]})]})]})}}}]);
//# sourceMappingURL=42.6073aec8.chunk.js.map