"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[42],{53747:function(e,t,n){n.d(t,{ZU:function(){return f},bK:function(){return l},tJ:function(){return d},uS:function(){return m}});var r=n(90675),o=n(5544),a=n(10467),c=n(79722),s=n(65043),i=n(42104),u=n(97665),d=u.z.object({name:u.z.string().min(2,"Name must be at least 2 characters").max(50,"Name must be at most 50 characters"),otherName:u.z.string().min(2,"Other name must be at least 2 characters").max(50,"Other name must be at most 50 characters"),email:u.z.string().email("Invalid email address"),gender:u.z.enum(["male","female","other"]),password:u.z.string().min(4,"Password must be at least 8 characters long").max(100,"Password must be at most 100 characters"),confirmPassword:u.z.string().min(4,"Confirm password must be at least 8 characters long").max(100,"Confirm password must be at most 100 characters").refine((function(e,t){return e===t.parent.password}),{message:"Passwords do not match"}),passport:u.z.string().regex(/^\d{8,15}$/,"Invalid passport/ID number"),selectedCountry:u.z.string().min(2,"Country is required"),provinces:u.z.string().optional(),language:u.z.string().min(2,"Language is required"),pic:u.z.string().url("Profile picture is required")});function l(e){var t=(0,s.useState)(null),n=(0,o.A)(t,2),r=n[0],a=n[1],c=(0,s.useRef)(null);return(0,s.useEffect)((function(){if(e&&e.token){if(!c.current){var t=e._id,n=(0,i.io)("/",{query:{token:e.token,userId:t}});return n.on("connect",(function(){console.log("connected"),a(n)})),n.on("disconnect",(function(e){console.log("Socket.IO disconnected due to:",e),"io server disconnect"===e&&n.connect()})),n.on("reconnect_attempt",(function(e){console.log("Reconnection attempt ".concat(e))})),n.on("error",(function(e){console.error("Socket.IO error:",e)})),c.current=n,function(){n&&n.disconnect(),c.current=null}}a(c.current)}}),[e]),r}function f(e,t,n,r){return p.apply(this,arguments)}function p(){return(p=(0,a.A)((0,r.A)().mark((function e(t,n,o,a){var s,i;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,s={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(o.token)}},e.next=6,c.A.post("/api/paycheck/makepaymentmpesa/".concat(o._id,"?amount=").concat(t),{phoneNumber:n},s);case 6:i=e.sent,i.data&&a({title:"You have been prompt to finish your subscription process",status:"info",duration:1e3,position:"bottom"}),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}function m(e,t,n){return h.apply(this,arguments)}function h(){return(h=(0,a.A)((0,r.A)().mark((function e(t,n,o){var a,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a={headers:{"Content-type":"application/json"}},e.next=6,c.A.post("/api/paycheck/donationsmpesa?amount=".concat(t),{phoneNumber:n},a);case 6:s=e.sent,s.data&&o({title:"You have been prompt to finish your subscription process",status:"info",duration:1e3,position:"bottom"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}},35042:function(e,t,n){n.r(t);var r=n(90675),o=n(10467),a=n(5544),c=n(65043),s=n(39081),i=n(22107),u=n(29301),d=n(56818),l=n(53747),f=n(51684),p=n(70579);t.default=function(){var e=(0,c.useState)(!1),t=(0,a.A)(e,2),n=t[0],m=t[1],h=(0,c.useState)(!0),v=(0,a.A)(h,2),g=v[0],b=v[1],k=(0,c.useRef)(null),S=(0,d.a)().user,x=(0,l.bK)(S),w=(0,c.useState)(!1),y=(0,a.A)(w,2),A=y[0],C=y[1];(0,c.useEffect)((function(){x&&(C(x.connected),x.on("connect",(function(){return C(!0)})),x.on("disconnect",(function(){return C(!1)})))}),[x]),(0,c.useEffect)((function(){if(A)return x.emit("checkLiveStream"),x.on("liveStreamStatus",(function(e){m(e),b(!1)})),x.on("stopped",(function(e){m(e)})),x.on("streamEnded",(function(){m(!1)})),function(){x.off("liveStreamStatus"),x.off("stopped"),x.off("streamEnded")}}),[A]);var z=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,o,a;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return console.log("Stream already active. Cannot start another."),e.abrupt("return");case 3:return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 6:t=e.sent,console.log("Media access granted:",t),o={localVideo:document.getElementById("localVideo"),configuration:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},onicecandidate:function(e){x.emit("onIceCandidate",e)}},a=f.G.WebRtcPeerSendonly(o,(function(e){if(e)return console.error(e);this.generateOffer((function(e,t){if(e)return console.error(e);x.emit("startStream",{sdpOffer:t})}))})),k.current=a,x.on("sdpAnswer",(function(e){console.log("Frontend received SDP answer from server:",e),k.current&&k.current.processAnswer(e)})),x.on("adminIceCandidate",(function(e){k.current&&k.current.addIceCandidate(e)})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.error("Error accessing media devices:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}(),E=function(){k.current&&(k.current.dispose(),k.current=null,m(!1),console.log("Stream stopped."),x.emit("stop"),x.off("sdpAnswer"),x.off("iceCandidate"))};return(0,c.useEffect)((function(){return function(){k.current&&E()}}),[]),g?(0,p.jsx)(s.E,{children:"Loading..."}):(0,p.jsxs)(i.a,{children:[(0,p.jsx)(s.E,{children:"No live stream active. Start your stream below."}),(0,p.jsx)(u.$,{colorScheme:"teal",isDisabled:n,onClick:z,children:"Start Live Stream"}),(0,p.jsx)(u.$,{colorScheme:"red",onClick:E,children:"Stop Live Stream"}),(0,p.jsx)("video",{id:"localVideo",autoPlay:!0,muted:!0,style:{display:n?"block":"none",width:"100%",height:"80vh"}})]})}}}]);
//# sourceMappingURL=42.bc97a807.chunk.js.map