{"version":3,"file":"static/js/731.a2ed2a53.chunk.js","mappings":"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","sources":["components/Status.jsx","pages/LivePage.jsx"],"sourcesContent":["import { Box } from \"@chakra-ui/layout\";\r\n\r\nconst StatusIndicator = ({ status, isConnected }) => (\r\n  <Box\r\n    p={2}\r\n    borderRadius=\"4px\"\r\n    bg={isConnected ? \"green.500\" : \"red.500\"}\r\n    color=\"white\"\r\n  >\r\n    {status}\r\n  </Box>\r\n);\r\n\r\nexport default StatusIndicator;\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport { FaPlay, FaStop } from \"react-icons/fa\";\r\nimport Janus from \"janus-gateway-js\";\r\nimport \"../App.css\";\r\nimport \"webrtc-adapter\";\r\nimport StatusIndicator from \"../components/Status\";\r\nimport { Box, Flex, Heading, Text, Spinner } from \"@chakra-ui/react\";\r\nimport { Button } from \"@chakra-ui/button\";\r\n\r\nconst JanusRtmpStreamer = () => {\r\n  const janusRef = useRef(null);\r\n  const [rtmpPlugin, setRtmpPlugin] = useState(null);\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const localVideoRef = useRef(null);\r\n  const localStreamRef = useRef(null);\r\n  const wsRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    initializeJanus();\r\n\r\n    return () => {\r\n      cleanUp();\r\n    };\r\n  }, []);\r\n\r\n  const initializeJanus = async () => {\r\n    try {\r\n      const janusInstance = new Janus({\r\n        server: \"/ws/\",\r\n        success: async () => {\r\n          const session = await janusInstance.createSession();\r\n          const plugin = await session.attachPlugin(\"janus.plugin.streaming\");\r\n\r\n          if (!plugin) {\r\n            throw new Error(\"Failed to attach streaming plugin\");\r\n          }\r\n\r\n          console.log(\"Streaming plugin attached!\");\r\n          setRtmpPlugin(plugin);\r\n          setConnected(true);\r\n\r\n          // Proceed with further setup if necessary, e.g., offering media\r\n          await attachStream(plugin);\r\n        },\r\n        error: (error) => console.error(\"Janus initialization error:\", error),\r\n      });\r\n      janusRef.current = janusInstance;\r\n    } catch (error) {\r\n      console.error(\"Error initializing Janus:\", error);\r\n    }\r\n  };\r\n\r\n  const attachStream = async (plugin) => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      });\r\n\r\n      localVideoRef.current.srcObject = stream;\r\n      localStreamRef.current = stream;\r\n\r\n      plugin.send({\r\n        message: { request: \"configure\", audio: true, video: true },\r\n      });\r\n\r\n      plugin.createOffer({\r\n        media: { video: true, audio: true },\r\n        stream,\r\n        success: (jsep) => {\r\n          console.log(\"Generated JSEP:\", jsep);\r\n          plugin.send({ message: { request: \"start\" }, jsep });\r\n        },\r\n        error: (error) => {\r\n          console.error(\"Error creating WebRTC offer:\", error);\r\n          alert(\"An error occurred during streaming setup. Please try again.\");\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error accessing user media:\", error);\r\n    }\r\n  };\r\n\r\n  const startStreaming = () => {\r\n    if (!rtmpPlugin) {\r\n      console.error(\"RTMP plugin not attached.\");\r\n      return;\r\n    }\r\n\r\n    const rtmpUrl = \"rtmp://nginx:1935/stream\";\r\n\r\n    rtmpPlugin.send({\r\n      message: { request: \"publish\", rtmp_url: rtmpUrl },\r\n      success: () => {\r\n        console.log(\"Publishing to RTMP successfully!\");\r\n        setStreaming(true);\r\n      },\r\n      error: (error) => console.error(\"Error publishing to RTMP:\", error),\r\n    });\r\n  };\r\n\r\n  const stopStreaming = () => {\r\n    if (rtmpPlugin) {\r\n      rtmpPlugin.hangup();\r\n      setStreaming(false);\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach((track) => track.stop());\r\n      }\r\n    }\r\n  };\r\n\r\n  const cleanUp = () => {\r\n    // Make sure janusRef.current is the Janus client instance\r\n    if (janusRef.current && typeof janusRef.current.destroy === \"function\") {\r\n      janusRef.current.destroy(); // Clean up Janus instance\r\n      console.log(\"Janus destroyed successfully\");\r\n    } else {\r\n      console.error(\"Janus instance not found or destroy method missing\");\r\n    }\r\n    // Close WebSocket connection if present\r\n    if (wsRef.current) {\r\n      wsRef.current.close();\r\n      console.log(\"WebSocket connection closed\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      display=\"flex\"\r\n      flexDirection=\"column\"\r\n      alignItems=\"center\"\r\n      width=\"100%\"\r\n      fontFamily=\"Arial, sans-serif\"\r\n      color=\"gray.800\"\r\n    >\r\n      <Box\r\n        position=\"relative\"\r\n        width=\"80%\"\r\n        maxWidth=\"720px\"\r\n        mb={5}\r\n        bg=\"black\"\r\n        borderRadius=\"8px\"\r\n        overflow=\"hidden\"\r\n      >\r\n        <video\r\n          ref={localVideoRef}\r\n          autoPlay\r\n          muted\r\n          width=\"100%\"\r\n          className=\"video-feed\"\r\n        />\r\n\r\n        {!connected && (\r\n          <Box\r\n            position=\"absolute\"\r\n            top={0}\r\n            left={0}\r\n            right={0}\r\n            bottom={0}\r\n            bg=\"rgba(0, 0, 0, 0.7)\"\r\n            color=\"white\"\r\n            display=\"flex\"\r\n            alignItems=\"center\"\r\n            justifyContent=\"center\"\r\n            fontSize=\"1.5rem\"\r\n          >\r\n            <Spinner size=\"lg\" />\r\n            <Text ml={2}>Connecting...</Text>\r\n          </Box>\r\n        )}\r\n      </Box>\r\n\r\n      <Box textAlign=\"center\" width=\"100%\" maxWidth=\"500px\">\r\n        <Heading as=\"h2\" size=\"lg\" mb={3}>\r\n          Live Stream Control\r\n        </Heading>\r\n\r\n        <Flex justifyContent=\"space-around\" mb={3}>\r\n          <StatusIndicator\r\n            status={connected ? \"Connected\" : \"Disconnected\"}\r\n            isConnected={connected}\r\n          />\r\n          <StatusIndicator\r\n            status={streaming ? \"Live\" : \"Idle\"}\r\n            isConnected={streaming}\r\n          />\r\n        </Flex>\r\n\r\n        <Flex justifyContent=\"center\" gap={3}>\r\n          <Button\r\n            leftIcon={<FaPlay />}\r\n            onClick={startStreaming}\r\n            isDisabled={streaming || !connected}\r\n            colorScheme=\"green\"\r\n            size=\"lg\"\r\n            fontSize={\"md\"}\r\n          >\r\n            Start Streaming\r\n          </Button>\r\n\r\n          <Button\r\n            leftIcon={<FaStop />}\r\n            onClick={stopStreaming}\r\n            isDisabled={!streaming}\r\n            colorScheme=\"red\"\r\n            size=\"lg\"\r\n            fontSize={\"md\"}\r\n          >\r\n            Stop Streaming\r\n          </Button>\r\n        </Flex>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default JanusRtmpStreamer;\r\n"],"names":["_ref","status","isConnected","_jsx","Box","p","borderRadius","bg","color","children","janusRef","useRef","_useState","useState","_useState2","_slicedToArray","rtmpPlugin","setRtmpPlugin","_useState3","_useState4","streaming","setStreaming","_useState5","_useState6","connected","setConnected","localVideoRef","localStreamRef","wsRef","useEffect","initializeJanus","cleanUp","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","janusInstance","wrap","_context2","prev","next","Janus","server","success","_success","_callee","session","plugin","_context","createSession","sent","attachPlugin","Error","console","log","attachStream","stop","apply","arguments","error","current","_ref2","_callee3","stream","_context3","navigator","mediaDevices","getUserMedia","video","audio","srcObject","send","message","request","createOffer","media","jsep","alert","t0","_x","destroy","close","_jsxs","display","flexDirection","alignItems","width","fontFamily","position","maxWidth","mb","overflow","ref","autoPlay","muted","className","top","left","right","bottom","justifyContent","fontSize","Spinner","size","Text","ml","textAlign","Heading","as","Flex","StatusIndicator","gap","Button","leftIcon","FaPlay","onClick","rtmp_url","isDisabled","colorScheme","FaStop","hangup","getTracks","forEach","track"],"sourceRoot":""}