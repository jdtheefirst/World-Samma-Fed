"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[42],{53747:function(e,t,n){n.d(t,{ZU:function(){return l},bK:function(){return f},tJ:function(){return p},uS:function(){return m}});var r=n(90675),o=n(5544),a=n(10467),s=n(79722),c=n(65043),u=n(42104),i=n(97665),p=i.z.object({name:i.z.string().min(2,"Name must be at least 2 characters").max(50,"Name must be at most 50 characters"),otherName:i.z.string().min(2,"Other name must be at least 2 characters").max(50,"Other name must be at most 50 characters"),email:i.z.string().email("Invalid email address"),gender:i.z.enum(["male","female","other"]),password:i.z.string().min(4,"Password must be at least 8 characters long").max(100,"Password must be at most 100 characters"),confirmPassword:i.z.string().min(4,"Confirm password must be at least 8 characters long").max(100,"Confirm password must be at most 100 characters").refine((function(e,t){return e===t.parent.password}),{message:"Passwords do not match"}),passport:i.z.string().regex(/^\d{8,15}$/,"Invalid passport/ID number"),selectedCountry:i.z.string().min(2,"Country is required"),provinces:i.z.string().optional(),language:i.z.string().min(2,"Language is required"),pic:i.z.string().url("Profile picture is required")});function f(e){var t=(0,c.useState)(null),n=(0,o.A)(t,2),r=n[0],a=n[1],s=(0,c.useRef)(null);return(0,c.useEffect)((function(){if(e&&e.token){if(!s.current){var t=e._id,n=(0,u.io)("/",{query:{token:e.token,userId:t}});return n.on("connect",(function(){console.log("connected"),a(n)})),n.on("disconnect",(function(e){console.log("Socket.IO disconnected due to:",e),"io server disconnect"===e&&n.connect()})),n.on("reconnect_attempt",(function(e){console.log("Reconnection attempt ".concat(e))})),n.on("error",(function(e){console.error("Socket.IO error:",e)})),s.current=n,function(){n&&n.disconnect(),s.current=null}}a(s.current)}}),[e]),r}function l(e,t,n,r){return d.apply(this,arguments)}function d(){return(d=(0,a.A)((0,r.A)().mark((function e(t,n,o,a){var c,u;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,c={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(o.token)}},e.next=6,s.A.post("/api/paycheck/makepaymentmpesa/".concat(o._id,"?amount=").concat(t),{phoneNumber:n},c);case 6:u=e.sent,u.data&&a({title:"You have been prompt to finish your subscription process",status:"info",duration:1e3,position:"bottom"}),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}function m(e,t,n){return h.apply(this,arguments)}function h(){return(h=(0,a.A)((0,r.A)().mark((function e(t,n,o){var a,c;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a={headers:{"Content-type":"application/json"}},e.next=6,s.A.post("/api/paycheck/donationsmpesa?amount=".concat(t),{phoneNumber:n},a);case 6:c=e.sent,c.data&&o({title:"You have been prompt to finish your subscription process",status:"info",duration:1e3,position:"bottom"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}},35042:function(e,t,n){n.r(t);var r=n(90675),o=n(10467),a=n(5544),s=n(65043),c=n(39081),u=n(22107),i=n(29301),p=n(56818),f=n(53747),l=n(51684),d=n(70579);t.default=function(){var e=(0,s.useState)(!1),t=(0,a.A)(e,2),n=t[0],m=t[1],h=(0,s.useState)(!0),v=(0,a.A)(h,2),g=v[0],b=v[1],x=(0,s.useRef)(null),A=(0,p.a)().user,w=(0,f.bK)(A),y=(0,s.useState)(!1),k=(0,a.A)(y,2),S=k[0],E=k[1];function C(){return P.apply(this,arguments)}function P(){return(P=(0,o.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:return t=e.sent,console.log("Media access granted:",t),e.abrupt("return",t);case 8:return e.prev=8,e.t0=e.catch(0),console.error("Error accessing media devices:",e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function z(){return I.apply(this,arguments)}function I(){return I=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n={localVideo:document.getElementById("localVideo"),configuration:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},onicecandidate:function(){var e=(0,o.A)((0,r.A)().mark((function e(t){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};l.G.WebRtcPeerSendonly(n,(function(n){if(n)return console.error("Error initializing Kurento Peer:",n),t(n);console.log("Kurento Peer initialized successfully."),e(this)}))})));case 1:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function j(e){return O.apply(this,arguments)}function O(){return(O=(0,o.A)((0,r.A)().mark((function e(t){return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/sendIceCandidate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidate:t})});case 3:console.log("ICE candidate sent to server."),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Error sending ICE candidate:",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function N(){return N=(0,o.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,z();case 7:if(t=e.sent){e.next=10;break}return e.abrupt("return");case 10:t.generateOffer(function(){var e=(0,o.A)((0,r.A)().mark((function e(n,o){var a,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return console.error("Error generating SDP offer:",n),e.abrupt("return");case 3:return e.next=5,D(o);case 5:(a=e.sent)?(t.processAnswer(a),console.log("SDP answer processed.")):console.log("No SDP answer received."),s=q(t),x.current={peer:t,pollInterval:s};case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function D(e){return L.apply(this,arguments)}function L(){return(L=(0,o.A)((0,r.A)().mark((function e(t){var n,o,a,s;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/start-stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sdpOffer:t})});case 3:if((n=e.sent).ok){e.next=10;break}return e.next=7,n.text();case 7:return o=e.sent,console.error("Error starting stream:",o),e.abrupt("return",null);case 10:return e.next=12,n.json();case 12:return a=e.sent,s=a.sdpAnswer,console.log("SDP answer received:",s),e.abrupt("return",s);case 18:return e.prev=18,e.t0=e.catch(0),console.error("Error in startStream function:",e.t0),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[0,18]])})))).apply(this,arguments)}function q(e){return setInterval((0,o.A)((0,r.A)().mark((function t(){var n,o;return(0,r.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/getIceCandidates");case 3:return n=t.sent,t.next=6,n.json();case 6:o=t.sent,o.candidates.forEach((function(t){return e.addIceCandidate(t)})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("Error fetching ICE candidates:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])}))),1e3)}(0,s.useEffect)((function(){w&&(E(w.connected),w.on("connect",(function(){return E(!0)})),w.on("disconnect",(function(){return E(!1)})))}),[w]),(0,s.useEffect)((function(){if(S)return w.emit("checkLiveStream"),w.on("liveStreamStatus",(function(e){m(e),b(!1)})),w.on("stopped",(function(e){m(e)})),w.on("streamEnded",(function(){m(!1)})),function(){w.off("liveStreamStatus"),w.off("stopped"),w.off("streamEnded")}}),[S]);var K=function(){x.current&&(x.current.dispose(),x.current=null,m(!1),console.log("Stream stopped."),w.emit("stop"),w.off("sdpAnswer"),w.off("iceCandidate"))};return(0,s.useEffect)((function(){return function(){x.current&&K()}}),[]),g?(0,d.jsx)(c.E,{children:"Loading..."}):(0,d.jsxs)(u.a,{children:[(0,d.jsx)(c.E,{children:"No live stream active. Start your stream below."}),(0,d.jsx)(i.$,{colorScheme:"teal",isDisabled:n,onClick:function(){return N.apply(this,arguments)},children:"Start Live Stream"}),(0,d.jsx)(i.$,{colorScheme:"red",onClick:K,children:"Stop Live Stream"}),(0,d.jsx)("video",{id:"localVideo",autoPlay:!0,muted:!0,style:{display:n?"block":"none",width:"100%",height:"80vh"}})]})}}}]);
//# sourceMappingURL=42.12b5e7df.chunk.js.map