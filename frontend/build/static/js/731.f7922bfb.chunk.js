"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[731],{80731:function(e,n,r){r.r(n),r.d(n,{default:function(){return b}});var t=r(90675),s=r(10467),o=r(5544),c=r(65043),i=r(60184),a=r(27787),u=r.n(a),l=(r(44050),r(58650),r(85522)),d=r(70579),f=function(e){var n=e.status,r=e.isConnected;return(0,d.jsx)(l.az,{p:2,borderRadius:"4px",bg:r?"green.500":"red.500",color:"white",children:n})},h=r(22107),p=r(76659),g=r(39081),x=r(28846),m=r(5371),v=r(38028),b=function(){var e=(0,c.useRef)(null),n=(0,c.useState)(null),r=(0,o.A)(n,2),a=r[0],l=r[1],b=(0,c.useState)(!1),j=(0,o.A)(b,2),w=j[0],y=j[1],C=(0,c.useState)(!1),S=(0,o.A)(C,2),k=S[0],R=S[1],A=(0,c.useRef)(null),z=(0,c.useRef)(null),E=(0,c.useRef)(null);(0,c.useEffect)((function(){return P(),function(){D()}}),[]);var P=function(){var n=(0,s.A)((0,t.A)().mark((function n(){var r,s,o,c;return(0,t.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=new(u().Client)("/ws/",{keepalive:!0}),e.current=r,n.next=5,r.createConnection("id");case 5:return s=n.sent,n.next=8,s.createSession();case 8:return o=n.sent,n.next=11,o.attachPlugin("janus.plugin.rtmp");case 11:if(c=n.sent){n.next=14;break}throw new Error("Failed to attach RTMP plugin");case 14:return console.log("RTMP plugin attached!"),l(c),R(!0),n.next=19,T(c);case 19:n.next=24;break;case 21:n.prev=21,n.t0=n.catch(0),console.error("Error initializing Janus:",n.t0);case 24:case"end":return n.stop()}}),n,null,[[0,21]])})));return function(){return n.apply(this,arguments)}}(),T=function(){var e=(0,s.A)((0,t.A)().mark((function e(n){var r;return(0,t.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:r=e.sent,A.current.srcObject=r,z.current=r,n.createOffer({media:{video:!0,audio:!0},stream:r,success:function(e){n.send({message:{request:"configure",audio:!0,video:!0},jsep_1:e})},error:function(e){return console.error("Error creating WebRTC offer:",e)}}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error accessing user media:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}(),D=function(){e.current&&"function"===typeof e.current.destroy?(e.current.destroy(),console.log("Janus destroyed successfully")):console.error("Janus instance not found or destroy method missing"),E.current&&(E.current.close(),console.log("WebSocket connection closed"))};return(0,d.jsxs)(h.a,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",fontFamily:"Arial, sans-serif",color:"gray.800",children:[(0,d.jsxs)(h.a,{position:"relative",width:"80%",maxWidth:"720px",mb:5,bg:"black",borderRadius:"8px",overflow:"hidden",children:[(0,d.jsx)("video",{ref:A,autoPlay:!0,muted:!0,width:"100%",className:"video-feed"}),!k&&(0,d.jsxs)(h.a,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"rgba(0, 0, 0, 0.7)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",children:[(0,d.jsx)(p.y,{size:"lg"}),(0,d.jsx)(g.E,{ml:2,children:"Connecting..."})]})]}),(0,d.jsxs)(h.a,{textAlign:"center",width:"100%",maxWidth:"500px",children:[(0,d.jsx)(x.D,{as:"h2",size:"lg",mb:3,children:"Live Stream Control"}),(0,d.jsxs)(m.s,{justifyContent:"space-around",mb:3,children:[(0,d.jsx)(f,{status:k?"Connected":"Disconnected",isConnected:k}),(0,d.jsx)(f,{status:w?"Live":"Idle",isConnected:w})]}),(0,d.jsxs)(m.s,{justifyContent:"center",gap:3,children:[(0,d.jsx)(v.$,{leftIcon:(0,d.jsx)(i.gSK,{}),onClick:function(){if(a){a.send({message:{request:"publish",rtmp_url:"/stream"},success:function(){console.log("Publishing to RTMP successfully!"),y(!0)},error:function(e){return console.error("Error publishing to RTMP:",e)}})}else console.error("RTMP plugin not attached.")},isDisabled:w||!k,colorScheme:"green",size:"lg",fontSize:"md",children:"Start Streaming"}),(0,d.jsx)(v.$,{leftIcon:(0,d.jsx)(i.wFo,{}),onClick:function(){a&&(a.hangup(),y(!1),z.current&&z.current.getTracks().forEach((function(e){return e.stop()})))},isDisabled:!w,colorScheme:"red",size:"lg",fontSize:"md",children:"Stop Streaming"})]})]})]})}}}]);
//# sourceMappingURL=731.f7922bfb.chunk.js.map