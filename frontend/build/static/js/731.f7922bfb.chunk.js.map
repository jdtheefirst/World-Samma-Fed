{"version":3,"file":"static/js/731.f7922bfb.chunk.js","mappings":"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","sources":["components/Status.jsx","pages/LivePage.jsx"],"sourcesContent":["import { Box } from \"@chakra-ui/layout\";\r\n\r\nconst StatusIndicator = ({ status, isConnected }) => (\r\n  <Box\r\n    p={2}\r\n    borderRadius=\"4px\"\r\n    bg={isConnected ? \"green.500\" : \"red.500\"}\r\n    color=\"white\"\r\n  >\r\n    {status}\r\n  </Box>\r\n);\r\n\r\nexport default StatusIndicator;\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport { FaPlay, FaStop } from \"react-icons/fa\";\r\nimport Janus from \"janus-gateway-js\";\r\nimport \"../App.css\";\r\nimport \"webrtc-adapter\";\r\nimport StatusIndicator from \"../components/Status\";\r\nimport { Box, Flex, Heading, Text, Spinner } from \"@chakra-ui/react\";\r\nimport { Button } from \"@chakra-ui/button\";\r\n\r\nconst JanusRtmpStreamer = () => {\r\n  const janusRef = useRef(null);\r\n  const [rtmpPlugin, setRtmpPlugin] = useState(null);\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const localVideoRef = useRef(null);\r\n  const localStreamRef = useRef(null);\r\n  const wsRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    initializeJanus();\r\n\r\n    return () => {\r\n      cleanUp();\r\n    };\r\n  }, []);\r\n\r\n  const initializeJanus = async () => {\r\n    try {\r\n      const janusInstance = new Janus.Client(\"/ws/\", { keepalive: true });\r\n      janusRef.current = janusInstance;\r\n\r\n      const connection = await janusInstance.createConnection(\"id\");\r\n      const session = await connection.createSession();\r\n\r\n      const plugin = await session.attachPlugin(\"janus.plugin.rtmp\");\r\n\r\n      if (!plugin) {\r\n        throw new Error(\"Failed to attach RTMP plugin\");\r\n      }\r\n\r\n      console.log(\"RTMP plugin attached!\");\r\n      setRtmpPlugin(plugin);\r\n      setConnected(true);\r\n\r\n      await attachStream(plugin); // Ensure we wait for the stream attachment to complete\r\n    } catch (error) {\r\n      console.error(\"Error initializing Janus:\", error);\r\n    }\r\n  };\r\n\r\n  const attachStream = async (plugin) => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      });\r\n      localVideoRef.current.srcObject = stream;\r\n      localStreamRef.current = stream;\r\n\r\n      plugin.createOffer({\r\n        media: { video: true, audio: true },\r\n        stream,\r\n        success: (jsep_1) => {\r\n          plugin.send({\r\n            message: { request: \"configure\", audio: true, video: true },\r\n            jsep_1,\r\n          });\r\n        },\r\n        error: (error_1) =>\r\n          console.error(\"Error creating WebRTC offer:\", error_1),\r\n      });\r\n    } catch (error_2) {\r\n      console.error(\"Error accessing user media:\", error_2);\r\n    }\r\n  };\r\n\r\n  const startStreaming = () => {\r\n    if (!rtmpPlugin) {\r\n      console.error(\"RTMP plugin not attached.\");\r\n      return;\r\n    }\r\n\r\n    const rtmpUrl = \"/stream\";\r\n    rtmpPlugin.send({\r\n      message: { request: \"publish\", rtmp_url: rtmpUrl },\r\n      success: () => {\r\n        console.log(\"Publishing to RTMP successfully!\");\r\n        setStreaming(true);\r\n      },\r\n      error: (error) => console.error(\"Error publishing to RTMP:\", error),\r\n    });\r\n  };\r\n\r\n  const stopStreaming = () => {\r\n    if (rtmpPlugin) {\r\n      rtmpPlugin.hangup();\r\n      setStreaming(false);\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach((track) => track.stop());\r\n      }\r\n    }\r\n  };\r\n\r\n  const cleanUp = () => {\r\n    // Make sure janusRef.current is the Janus client instance\r\n    if (janusRef.current && typeof janusRef.current.destroy === \"function\") {\r\n      janusRef.current.destroy(); // Clean up Janus instance\r\n      console.log(\"Janus destroyed successfully\");\r\n    } else {\r\n      console.error(\"Janus instance not found or destroy method missing\");\r\n    }\r\n    // Close WebSocket connection if present\r\n    if (wsRef.current) {\r\n      wsRef.current.close();\r\n      console.log(\"WebSocket connection closed\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      display=\"flex\"\r\n      flexDirection=\"column\"\r\n      alignItems=\"center\"\r\n      width=\"100%\"\r\n      fontFamily=\"Arial, sans-serif\"\r\n      color=\"gray.800\"\r\n    >\r\n      <Box\r\n        position=\"relative\"\r\n        width=\"80%\"\r\n        maxWidth=\"720px\"\r\n        mb={5}\r\n        bg=\"black\"\r\n        borderRadius=\"8px\"\r\n        overflow=\"hidden\"\r\n      >\r\n        <video\r\n          ref={localVideoRef}\r\n          autoPlay\r\n          muted\r\n          width=\"100%\"\r\n          className=\"video-feed\"\r\n        />\r\n\r\n        {!connected && (\r\n          <Box\r\n            position=\"absolute\"\r\n            top={0}\r\n            left={0}\r\n            right={0}\r\n            bottom={0}\r\n            bg=\"rgba(0, 0, 0, 0.7)\"\r\n            color=\"white\"\r\n            display=\"flex\"\r\n            alignItems=\"center\"\r\n            justifyContent=\"center\"\r\n            fontSize=\"1.5rem\"\r\n          >\r\n            <Spinner size=\"lg\" />\r\n            <Text ml={2}>Connecting...</Text>\r\n          </Box>\r\n        )}\r\n      </Box>\r\n\r\n      <Box textAlign=\"center\" width=\"100%\" maxWidth=\"500px\">\r\n        <Heading as=\"h2\" size=\"lg\" mb={3}>\r\n          Live Stream Control\r\n        </Heading>\r\n\r\n        <Flex justifyContent=\"space-around\" mb={3}>\r\n          <StatusIndicator\r\n            status={connected ? \"Connected\" : \"Disconnected\"}\r\n            isConnected={connected}\r\n          />\r\n          <StatusIndicator\r\n            status={streaming ? \"Live\" : \"Idle\"}\r\n            isConnected={streaming}\r\n          />\r\n        </Flex>\r\n\r\n        <Flex justifyContent=\"center\" gap={3}>\r\n          <Button\r\n            leftIcon={<FaPlay />}\r\n            onClick={startStreaming}\r\n            isDisabled={streaming || !connected}\r\n            colorScheme=\"green\"\r\n            size=\"lg\"\r\n            fontSize={\"md\"}\r\n          >\r\n            Start Streaming\r\n          </Button>\r\n\r\n          <Button\r\n            leftIcon={<FaStop />}\r\n            onClick={stopStreaming}\r\n            isDisabled={!streaming}\r\n            colorScheme=\"red\"\r\n            size=\"lg\"\r\n            fontSize={\"md\"}\r\n          >\r\n            Stop Streaming\r\n          </Button>\r\n        </Flex>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default JanusRtmpStreamer;\r\n"],"names":["_ref","status","isConnected","_jsx","Box","p","borderRadius","bg","color","children","janusRef","useRef","_useState","useState","_useState2","_slicedToArray","rtmpPlugin","setRtmpPlugin","_useState3","_useState4","streaming","setStreaming","_useState5","_useState6","connected","setConnected","localVideoRef","localStreamRef","wsRef","useEffect","initializeJanus","cleanUp","_asyncToGenerator","_regeneratorRuntime","mark","_callee","janusInstance","connection","session","plugin","wrap","_context","prev","next","Janus","keepalive","current","createConnection","sent","createSession","attachPlugin","Error","console","log","attachStream","t0","error","stop","apply","arguments","_ref2","_callee2","stream","_context2","navigator","mediaDevices","getUserMedia","video","audio","srcObject","createOffer","media","success","jsep_1","send","message","request","error_1","_x","destroy","close","_jsxs","display","flexDirection","alignItems","width","fontFamily","position","maxWidth","mb","overflow","ref","autoPlay","muted","className","top","left","right","bottom","justifyContent","fontSize","Spinner","size","Text","ml","textAlign","Heading","as","Flex","StatusIndicator","gap","Button","leftIcon","FaPlay","onClick","rtmp_url","isDisabled","colorScheme","FaStop","hangup","getTracks","forEach","track"],"sourceRoot":""}