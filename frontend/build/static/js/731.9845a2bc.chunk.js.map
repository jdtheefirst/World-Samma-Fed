{"version":3,"file":"static/js/731.9845a2bc.chunk.js","mappings":"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","sources":["components/Status.jsx","pages/LivePage.jsx"],"sourcesContent":["import { Box } from \"@chakra-ui/layout\";\r\n\r\nconst StatusIndicator = ({ status, isConnected }) => (\r\n  <Box\r\n    p={2}\r\n    borderRadius=\"4px\"\r\n    bg={isConnected ? \"green.500\" : \"red.500\"}\r\n    color=\"white\"\r\n  >\r\n    {status}\r\n  </Box>\r\n);\r\n\r\nexport default StatusIndicator;\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport { FaPlay, FaStop } from \"react-icons/fa\";\r\nimport Janus from \"janus-gateway-js\";\r\nimport \"../App.css\";\r\nimport \"webrtc-adapter\";\r\nimport StatusIndicator from \"../components/Status\";\r\nimport { Box, Flex, Heading, Text, Spinner } from \"@chakra-ui/react\";\r\nimport { Button } from \"@chakra-ui/button\";\r\n\r\nconst JanusRtmpStreamer = () => {\r\n  const janusRef = useRef(null);\r\n  const [rtmpPlugin, setRtmpPlugin] = useState(null);\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const localVideoRef = useRef(null);\r\n  const localStreamRef = useRef(null);\r\n  const transaction = `txn-${Date.now()}`;\r\n  const wsRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    initializeJanus();\r\n\r\n    return () => {\r\n      cleanUp();\r\n    };\r\n  }, []);\r\n\r\n  const initializeJanus = async () => {\r\n    try {\r\n      const janusClient = new Janus.Client(\"/ws/\", {\r\n        keepalive: true,\r\n      });\r\n      janusRef.current = janusClient;\r\n\r\n      const connection = await janusClient.createConnection(\"connection-id\");\r\n      const session = await connection.createSession();\r\n      const plugin = await session.attachPlugin(\"janus.plugin.streaming\");\r\n\r\n      if (!plugin) {\r\n        throw new Error(\"Failed to attach streaming plugin\");\r\n      }\r\n\r\n      console.log(\"Streaming plugin attached!\");\r\n      setRtmpPlugin(plugin);\r\n      setConnected(true);\r\n\r\n      await attachStream(plugin);\r\n    } catch (error) {\r\n      console.error(\"Error initializing Janus:\", error);\r\n    }\r\n  };\r\n\r\n  const attachStream = async (plugin) => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      });\r\n\r\n      localVideoRef.current.srcObject = stream;\r\n      localStreamRef.current = stream;\r\n\r\n      await plugin.send({\r\n        message: {\r\n          janus: \"message\",\r\n          transaction,\r\n          body: { request: \"configure\", audio: true, video: true },\r\n        },\r\n      });\r\n\r\n      plugin.onmessage = (msg) => {\r\n        console.log(\"Configure Response from Janus:\", msg);\r\n        if (msg.janus === \"success\") {\r\n          console.log(\"Configuration successful!\");\r\n        } else if (msg.janus === \"error\") {\r\n          console.error(\"Error configuring plugin:\", msg.error);\r\n        }\r\n      };\r\n\r\n      plugin.createOffer({\r\n        media: { video: true, audio: true },\r\n        stream,\r\n        success: (jsep) => {\r\n          console.log(\"Generated JSEP:\", jsep);\r\n          plugin.send({\r\n            message: {\r\n              janus: \"message\",\r\n              transaction,\r\n              body: { request: \"start\" },\r\n              jsep,\r\n            },\r\n          });\r\n          plugin.onmessage = (msg) => {\r\n            console.log(\"Start Response from Janus:\", msg);\r\n            if (msg.janus === \"success\") {\r\n              console.log(\"Streaming started successfully!\");\r\n            } else if (msg.janus === \"error\") {\r\n              console.error(\"Error starting stream:\", msg.error);\r\n            }\r\n          };\r\n        },\r\n        error: (error) => {\r\n          console.error(\"Error creating WebRTC offer:\", error);\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error accessing user media:\", error);\r\n    }\r\n  };\r\n\r\n  const startStreaming = () => {\r\n    if (!rtmpPlugin) {\r\n      console.error(\"RTMP plugin not attached.\");\r\n      return;\r\n    }\r\n\r\n    const rtmpUrl = \"rtmp://nginx:1935/stream\";\r\n\r\n    rtmpPlugin.send({\r\n      message: {\r\n        janus: \"message\",\r\n        transaction,\r\n        body: { request: \"publish\", rtmp_url: rtmpUrl },\r\n      },\r\n    });\r\n    rtmpPlugin.onmessage = (msg) => {\r\n      console.log(\"Janus Plugin Message:\", msg);\r\n      if (msg.janus === \"success\") {\r\n        console.log(\"Publishing to RTMP successfully!\");\r\n        setStreaming(true);\r\n      } else if (msg.janus === \"error\") {\r\n        console.error(\"Error from Janus:\", msg.error);\r\n      }\r\n    };\r\n  };\r\n\r\n  const stopStreaming = () => {\r\n    if (rtmpPlugin) {\r\n      rtmpPlugin.hangup();\r\n      setStreaming(false);\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach((track) => track.stop());\r\n      }\r\n    }\r\n  };\r\n\r\n  const cleanUp = () => {\r\n    // Make sure janusRef.current is the Janus client instance\r\n    if (janusRef.current && typeof janusRef.current.destroy === \"function\") {\r\n      janusRef.current.destroy(); // Clean up Janus instance\r\n      console.log(\"Janus destroyed successfully\");\r\n    } else {\r\n      console.error(\"Janus instance not found or destroy method missing\");\r\n    }\r\n    // Close WebSocket connection if present\r\n    if (wsRef.current) {\r\n      wsRef.current.close();\r\n      console.log(\"WebSocket connection closed\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      display=\"flex\"\r\n      flexDirection=\"column\"\r\n      alignItems=\"center\"\r\n      width=\"100%\"\r\n      fontFamily=\"Arial, sans-serif\"\r\n      color=\"gray.800\"\r\n    >\r\n      <Box\r\n        position=\"relative\"\r\n        width=\"80%\"\r\n        maxWidth=\"720px\"\r\n        mb={5}\r\n        bg=\"black\"\r\n        borderRadius=\"8px\"\r\n        overflow=\"hidden\"\r\n      >\r\n        <video\r\n          ref={localVideoRef}\r\n          autoPlay\r\n          muted\r\n          width=\"100%\"\r\n          className=\"video-feed\"\r\n        />\r\n\r\n        {!connected && (\r\n          <Box\r\n            position=\"absolute\"\r\n            top={0}\r\n            left={0}\r\n            right={0}\r\n            bottom={0}\r\n            bg=\"rgba(0, 0, 0, 0.7)\"\r\n            color=\"white\"\r\n            display=\"flex\"\r\n            alignItems=\"center\"\r\n            justifyContent=\"center\"\r\n            fontSize=\"1.5rem\"\r\n          >\r\n            <Spinner size=\"lg\" />\r\n            <Text ml={2}>Connecting...</Text>\r\n          </Box>\r\n        )}\r\n      </Box>\r\n\r\n      <Box textAlign=\"center\" width=\"100%\" maxWidth=\"500px\">\r\n        <Heading as=\"h2\" size=\"lg\" mb={3}>\r\n          Live Stream Control\r\n        </Heading>\r\n\r\n        <Flex justifyContent=\"space-around\" mb={3}>\r\n          <StatusIndicator\r\n            status={connected ? \"Connected\" : \"Disconnected\"}\r\n            isConnected={connected}\r\n          />\r\n          <StatusIndicator\r\n            status={streaming ? \"Live\" : \"Idle\"}\r\n            isConnected={streaming}\r\n          />\r\n        </Flex>\r\n\r\n        <Flex justifyContent=\"center\" gap={3}>\r\n          <Button\r\n            leftIcon={<FaPlay />}\r\n            onClick={startStreaming}\r\n            isDisabled={streaming || !connected}\r\n            colorScheme=\"green\"\r\n            size=\"lg\"\r\n            fontSize={\"md\"}\r\n          >\r\n            Start Streaming\r\n          </Button>\r\n\r\n          <Button\r\n            leftIcon={<FaStop />}\r\n            onClick={stopStreaming}\r\n            isDisabled={!streaming}\r\n            colorScheme=\"red\"\r\n            size=\"lg\"\r\n            fontSize={\"md\"}\r\n          >\r\n            Stop Streaming\r\n          </Button>\r\n        </Flex>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default JanusRtmpStreamer;\r\n"],"names":["_ref","status","isConnected","_jsx","Box","p","borderRadius","bg","color","children","janusRef","useRef","_useState","useState","_useState2","_slicedToArray","rtmpPlugin","setRtmpPlugin","_useState3","_useState4","streaming","setStreaming","_useState5","_useState6","connected","setConnected","localVideoRef","localStreamRef","transaction","concat","Date","now","wsRef","useEffect","initializeJanus","cleanUp","_asyncToGenerator","_regeneratorRuntime","mark","_callee","janusClient","connection","session","plugin","wrap","_context","prev","next","Janus","keepalive","current","createConnection","sent","createSession","attachPlugin","Error","console","log","attachStream","t0","error","stop","apply","arguments","_ref2","_callee2","stream","_context2","navigator","mediaDevices","getUserMedia","video","audio","srcObject","send","message","janus","body","request","onmessage","msg","createOffer","media","success","jsep","_x","destroy","close","_jsxs","display","flexDirection","alignItems","width","fontFamily","position","maxWidth","mb","overflow","ref","autoPlay","muted","className","top","left","right","bottom","justifyContent","fontSize","Spinner","size","Text","ml","textAlign","Heading","as","Flex","StatusIndicator","gap","Button","leftIcon","FaPlay","onClick","rtmp_url","isDisabled","colorScheme","FaStop","hangup","getTracks","forEach","track"],"sourceRoot":""}