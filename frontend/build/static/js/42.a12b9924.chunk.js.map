{"version":3,"file":"static/js/42.a12b9924.chunk.js","mappings":"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","sources":["pages/LivePage.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport { FaPlay, FaStop } from \"react-icons/fa\";\r\nimport Janus from \"janus-gateway\";\r\n\r\nconst JanusRtmpStreamer = () => {\r\n  const [janus, setJanus] = useState(null);\r\n  const [rtmpPlugin, setRtmpPlugin] = useState(null);\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const [isWsConnected, setIsWsConnected] = useState(false);\r\n  const localVideoRef = useRef(null);\r\n  const localStreamRef = useRef(null);\r\n\r\n  const ipRef = useRef(null); // Keep WebSocket connection persistent across renders\r\n\r\n  useEffect(() => {\r\n    // Initialize WebSocket connection via backend proxy\r\n    if (!ipRef.current) {\r\n      ipRef.current = new WebSocket(\"/ws/\"); // Use backend proxy here\r\n\r\n      ipRef.current.onopen = () => {\r\n        setIsWsConnected(true);\r\n        console.log(\"WebSocket connected to Janus\");\r\n      };\r\n\r\n      ipRef.current.onclose = () => {\r\n        setIsWsConnected(false);\r\n        console.log(\"WebSocket closed Janus connection\");\r\n      };\r\n\r\n      ipRef.current.onerror = (error) => {\r\n        console.error(\"WebSocket error\", error);\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      if (ipRef.current) {\r\n        ipRef.current.close(); // Clean up WebSocket connection on component unmount\r\n      }\r\n    };\r\n  }, []); // Run only once\r\n\r\n  useEffect(() => {\r\n    // Initialize Janus only if WebSocket connection is established\r\n    if (isWsConnected) {\r\n      Janus.init({\r\n        debug: \"all\",\r\n        callback: () => {\r\n          const janusInstance = new Janus({\r\n            server: \"/ws/\",\r\n            success: () => {\r\n              attachRtmpPlugin(janusInstance);\r\n            },\r\n            error: (error) => {\r\n              console.error(\"Janus error:\", error);\r\n            },\r\n          });\r\n          setJanus(janusInstance);\r\n        },\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      if (janus) {\r\n        janus.destroy();\r\n      }\r\n    };\r\n  }, [isWsConnected]); // Trigger Janus init when WebSocket is connected\r\n\r\n  const attachRtmpPlugin = (janusInstance) => {\r\n    janusInstance.attach({\r\n      plugin: \"janus.plugin.rtmp\",\r\n      success: (pluginHandle) => {\r\n        setRtmpPlugin(pluginHandle);\r\n        console.log(\"RTMP plugin attached!\");\r\n        startLocalStream(); // Start capturing local video stream\r\n      },\r\n      error: (error) => {\r\n        console.error(\"Error attaching RTMP plugin:\", error);\r\n      },\r\n      webrtcState: (on) => {\r\n        setConnected(on);\r\n        console.log(\"WebRTC peer connection is \", on ? \"up\" : \"down\");\r\n      },\r\n      onmessage: (msg, jsep) => {\r\n        console.log(\"Message received from RTMP plugin:\", msg);\r\n      },\r\n      onlocalstream: (stream) => {\r\n        localVideoRef.current.srcObject = stream;\r\n      },\r\n    });\r\n  };\r\n\r\n  const startLocalStream = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      });\r\n      localVideoRef.current.srcObject = stream;\r\n      localStreamRef.current = stream;\r\n\r\n      if (rtmpPlugin) {\r\n        rtmpPlugin.createOffer({\r\n          media: { video: true, audio: true, data: false },\r\n          stream: localStreamRef.current,\r\n          success: (jsep) => {\r\n            rtmpPlugin.send({\r\n              message: { request: \"configure\", audio: true, video: true },\r\n              jsep,\r\n            });\r\n          },\r\n          error: (error) => {\r\n            console.error(\"Error creating WebRTC offer:\", error);\r\n          },\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error accessing user media:\", error);\r\n    }\r\n  };\r\n\r\n  const startStreaming = () => {\r\n    if (!rtmpPlugin) {\r\n      console.error(\"RTMP plugin not attached.\");\r\n      return;\r\n    }\r\n\r\n    // const rtmpUrl = \"rtmp://167.99.44.195:1935/stream\";\r\n    const rtmpUrl = \"rtmp://nginx/stream\";\r\n    rtmpPlugin.send({\r\n      message: {\r\n        request: \"publish\",\r\n        rtmp_url: rtmpUrl,\r\n      },\r\n      success: () => {\r\n        console.log(\"Publishing to RTMP successfully!\");\r\n        setStreaming(true);\r\n      },\r\n      error: (error) => {\r\n        console.error(\"Error publishing to RTMP:\", error);\r\n      },\r\n    });\r\n  };\r\n\r\n  const stopStreaming = () => {\r\n    if (rtmpPlugin) {\r\n      rtmpPlugin.hangup();\r\n      setStreaming(false);\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach((track) => track.stop()); // Stop all tracks\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"streaming-container\">\r\n      <div className=\"video-wrapper\">\r\n        <video ref={localVideoRef} autoPlay muted className=\"video-feed\" />\r\n        {!connected && <div className=\"overlay\">Connecting...</div>}\r\n      </div>\r\n      <div className=\"control-panel\">\r\n        <h2>Live Stream Control</h2>\r\n        <div className=\"status-indicators\">\r\n          <div className={`status ${connected ? \"connected\" : \"disconnected\"}`}>\r\n            {connected ? \"Connected\" : \"Disconnected\"}\r\n          </div>\r\n          <div className={`status ${streaming ? \"live\" : \"idle\"}`}>\r\n            {streaming ? \"Live\" : \"Idle\"}\r\n          </div>\r\n        </div>\r\n        <div className=\"controls\">\r\n          <button\r\n            onClick={startStreaming}\r\n            disabled={streaming}\r\n            className=\"start-btn\"\r\n          >\r\n            <FaPlay /> Start Streaming\r\n          </button>\r\n          <button\r\n            onClick={stopStreaming}\r\n            disabled={!streaming}\r\n            className=\"stop-btn\"\r\n          >\r\n            <FaStop /> Stop Streaming\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default JanusRtmpStreamer;\r\n"],"names":["_useState","useState","_useState2","_slicedToArray","janus","setJanus","_useState3","_useState4","rtmpPlugin","setRtmpPlugin","_useState5","_useState6","streaming","setStreaming","_useState7","_useState8","connected","setConnected","_useState9","_useState10","isWsConnected","setIsWsConnected","localVideoRef","useRef","localStreamRef","ipRef","useEffect","current","WebSocket","onopen","console","log","onclose","onerror","error","close","Janus","init","debug","callback","janusInstance","server","success","attachRtmpPlugin","destroy","attach","plugin","pluginHandle","startLocalStream","webrtcState","on","onmessage","msg","jsep","onlocalstream","stream","srcObject","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","navigator","mediaDevices","getUserMedia","video","audio","sent","createOffer","media","data","send","message","request","t0","stop","apply","arguments","_jsxs","className","children","_jsx","ref","autoPlay","muted","concat","onClick","rtmp_url","disabled","FaPlay","hangup","getTracks","forEach","track","FaStop"],"sourceRoot":""}