"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[731],{80731:function(e,n,r){r.r(n),r.d(n,{default:function(){return b}});var s=r(90675),t=r(10467),o=r(5544),c=r(65043),a=r(60184),i=r(27787),u=r.n(i),l=(r(44050),r(58650),r(85522)),d=r(70579),f=function(e){var n=e.status,r=e.isConnected;return(0,d.jsx)(l.az,{p:2,borderRadius:"4px",bg:r?"green.500":"red.500",color:"white",children:n})},g=r(22107),m=r(76659),p=r(39081),h=r(28846),x=r(5371),j=r(38028),b=function(){var e=(0,c.useRef)(null),n=(0,c.useState)(null),r=(0,o.A)(n,2),i=r[0],l=r[1],b=(0,c.useState)(!1),v=(0,o.A)(b,2),y=v[0],S=v[1],w=(0,c.useState)(!1),C=(0,o.A)(w,2),k=C[0],A=C[1],E=(0,c.useRef)(null),R=(0,c.useRef)(null),z="txn-".concat(Date.now()),J=(0,c.useRef)(null);(0,c.useEffect)((function(){return D(),function(){I()}}),[]);var D=function(){var n=(0,t.A)((0,s.A)().mark((function n(){var r,t,o,c;return(0,s.A)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=new(u().Client)("/ws/",{keepalive:!0}),e.current=r,n.next=5,r.createConnection("connection-id");case 5:return t=n.sent,n.next=8,t.createSession();case 8:return o=n.sent,n.next=11,o.attachPlugin("janus.plugin.streaming");case 11:if(c=n.sent){n.next=14;break}throw new Error("Failed to attach streaming plugin");case 14:return console.log("Streaming plugin attached!"),l(c),A(!0),n.next=19,P(c);case 19:n.next=24;break;case 21:n.prev=21,n.t0=n.catch(0),console.error("Error initializing Janus:",n.t0);case 24:case"end":return n.stop()}}),n,null,[[0,21]])})));return function(){return n.apply(this,arguments)}}(),P=function(){var e=(0,t.A)((0,s.A)().mark((function e(n){var r;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:return r=e.sent,E.current.srcObject=r,R.current=r,e.next=8,n.send({message:{janus:"message",transaction:z,body:{request:"configure",audio:!0,video:!0}}});case 8:n.onmessage=function(e){console.log("Configure Response from Janus:",e),"success"===e.janus?console.log("Configuration successful!"):"error"===e.janus&&console.error("Error configuring plugin:",e.error)},n.createOffer({media:{video:!0,audio:!0},stream:r,success:function(e){console.log("Generated JSEP:",e),n.send({message:{janus:"message",transaction:z,body:{request:"start"},jsep:e}}),n.onmessage=function(e){console.log("Start Response from Janus:",e),"success"===e.janus?console.log("Streaming started successfully!"):"error"===e.janus&&console.error("Error starting stream:",e.error)}},error:function(e){console.error("Error creating WebRTC offer:",e)}}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Error accessing user media:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(n){return e.apply(this,arguments)}}(),I=function(){e.current&&"function"===typeof e.current.destroy?(e.current.destroy(),console.log("Janus destroyed successfully")):console.error("Janus instance not found or destroy method missing"),J.current&&(J.current.close(),console.log("WebSocket connection closed"))};return(0,d.jsxs)(g.a,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",fontFamily:"Arial, sans-serif",color:"gray.800",children:[(0,d.jsxs)(g.a,{position:"relative",width:"80%",maxWidth:"720px",mb:5,bg:"black",borderRadius:"8px",overflow:"hidden",children:[(0,d.jsx)("video",{ref:E,autoPlay:!0,muted:!0,width:"100%",className:"video-feed"}),!k&&(0,d.jsxs)(g.a,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"rgba(0, 0, 0, 0.7)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",children:[(0,d.jsx)(m.y,{size:"lg"}),(0,d.jsx)(p.E,{ml:2,children:"Connecting..."})]})]}),(0,d.jsxs)(g.a,{textAlign:"center",width:"100%",maxWidth:"500px",children:[(0,d.jsx)(h.D,{as:"h2",size:"lg",mb:3,children:"Live Stream Control"}),(0,d.jsxs)(x.s,{justifyContent:"space-around",mb:3,children:[(0,d.jsx)(f,{status:k?"Connected":"Disconnected",isConnected:k}),(0,d.jsx)(f,{status:y?"Live":"Idle",isConnected:y})]}),(0,d.jsxs)(x.s,{justifyContent:"center",gap:3,children:[(0,d.jsx)(j.$,{leftIcon:(0,d.jsx)(a.gSK,{}),onClick:function(){if(i){i.send({message:{janus:"message",transaction:z,body:{request:"publish",rtmp_url:"rtmp://nginx:1935/stream"}}}),i.onmessage=function(e){console.log("Janus Plugin Message:",e),"success"===e.janus?(console.log("Publishing to RTMP successfully!"),S(!0)):"error"===e.janus&&console.error("Error from Janus:",e.error)}}else console.error("RTMP plugin not attached.")},isDisabled:y||!k,colorScheme:"green",size:"lg",fontSize:"md",children:"Start Streaming"}),(0,d.jsx)(j.$,{leftIcon:(0,d.jsx)(a.wFo,{}),onClick:function(){i&&(i.hangup(),S(!1),R.current&&R.current.getTracks().forEach((function(e){return e.stop()})))},isDisabled:!y,colorScheme:"red",size:"lg",fontSize:"md",children:"Stop Streaming"})]})]})]})}}}]);
//# sourceMappingURL=731.9845a2bc.chunk.js.map