{"version":3,"file":"static/js/42.46cfb56a.chunk.js","mappings":"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","sources":["pages/LivePage.jsx"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport \"webrtc-adapter\";\r\nimport Janus from \"janus-gateway\";\r\nimport { FaPlay, FaStop, FaVideo } from \"react-icons/fa\";\r\n\r\nconst JanusRtmpStreamer = () => {\r\n  const [janus, setJanus] = useState(null);\r\n  const [rtmpPlugin, setRtmpPlugin] = useState(null);\r\n  const [streaming, setStreaming] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const [isWsConnected, setIsWsConnected] = useState(false);\r\n  const localVideoRef = useRef(null);\r\n\r\n  const ipRef = useRef(null); // Keep WebSocket connection persistent across renders\r\n\r\n  useEffect(() => {\r\n    // Initialize WebSocket connection via backend proxy\r\n    if (!ipRef.current) {\r\n      ipRef.current = new WebSocket(\"/\"); // Use backend proxy here\r\n\r\n      ipRef.current.onopen = () => {\r\n        setIsWsConnected(true);\r\n        console.log(\"WebSocket connected to Janus via backend proxy\");\r\n      };\r\n\r\n      ipRef.current.onclose = () => {\r\n        setIsWsConnected(false);\r\n        console.log(\"WebSocket closed Janus connection\");\r\n      };\r\n\r\n      ipRef.current.onerror = (error) => {\r\n        console.error(\"WebSocket error with Janus, not even /\", error);\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      if (ipRef.current) {\r\n        ipRef.current.close(); // Clean up WebSocket connection on component unmount\r\n      }\r\n    };\r\n  }, []); // Run only once\r\n\r\n  useEffect(() => {\r\n    // Initialize Janus only if WebSocket connection is established\r\n    if (isWsConnected) {\r\n      Janus.init({\r\n        debug: \"all\",\r\n        callback: () => {\r\n          const janusInstance = new Janus({\r\n            server: \"ws://janus:8188\",\r\n            success: () => {\r\n              attachRtmpPlugin(janusInstance);\r\n            },\r\n            error: (error) => {\r\n              console.error(\"Janus error:\", error);\r\n            },\r\n          });\r\n          setJanus(janusInstance);\r\n        },\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      if (janus) {\r\n        janus.destroy();\r\n      }\r\n    };\r\n  }, [isWsConnected]); // Trigger Janus init when WebSocket is connected\r\n\r\n  const attachRtmpPlugin = (janusInstance) => {\r\n    janusInstance.attach({\r\n      plugin: \"janus.plugin.rtmp\",\r\n      success: (pluginHandle) => {\r\n        setRtmpPlugin(pluginHandle);\r\n        console.log(\"RTMP plugin attached!\");\r\n      },\r\n      error: (error) => {\r\n        console.error(\"Error attaching RTMP plugin:\", error);\r\n      },\r\n      webrtcState: (on) => {\r\n        setConnected(on);\r\n        console.log(\"WebRTC peer connection is \", on ? \"up\" : \"down\");\r\n      },\r\n      onmessage: (msg, jsep) => {\r\n        console.log(\"Message received from RTMP plugin:\", msg);\r\n      },\r\n      onlocalstream: (stream) => {\r\n        localVideoRef.current.srcObject = stream;\r\n      },\r\n    });\r\n  };\r\n\r\n  const startStreaming = () => {\r\n    if (!rtmpPlugin) {\r\n      console.error(\"RTMP plugin not attached.\");\r\n      return;\r\n    }\r\n\r\n    const rtmpUrl = \"rtmp://167.99.44.195:1935/stream\";\r\n    rtmpPlugin.publish({\r\n      stream: rtmpUrl,\r\n      success: () => {\r\n        console.log(\"Publishing to RTMP successfully!\");\r\n        setStreaming(true);\r\n      },\r\n      error: (error) => {\r\n        console.error(\"Error publishing to RTMP:\", error);\r\n      },\r\n    });\r\n  };\r\n\r\n  const stopStreaming = () => {\r\n    if (rtmpPlugin) {\r\n      rtmpPlugin.hangup();\r\n      setStreaming(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"streaming-container\">\r\n      <div className=\"video-wrapper\">\r\n        <video ref={localVideoRef} autoPlay muted className=\"video-feed\" />\r\n        {!connected && <div className=\"overlay\">Connecting...</div>}\r\n      </div>\r\n      <div className=\"control-panel\">\r\n        <h2>Live Stream Control</h2>\r\n        <div className=\"status-indicators\">\r\n          <div className={`status ${connected ? \"connected\" : \"disconnected\"}`}>\r\n            {connected ? \"Connected\" : \"Disconnected\"}\r\n          </div>\r\n          <div className={`status ${streaming ? \"live\" : \"idle\"}`}>\r\n            {streaming ? \"Live\" : \"Idle\"}\r\n          </div>\r\n        </div>\r\n        <div className=\"controls\">\r\n          <button\r\n            onClick={startStreaming}\r\n            disabled={streaming}\r\n            className=\"start-btn\"\r\n          >\r\n            <FaPlay /> Start Streaming\r\n          </button>\r\n          <button\r\n            onClick={stopStreaming}\r\n            disabled={!streaming}\r\n            className=\"stop-btn\"\r\n          >\r\n            <FaStop /> Stop Streaming\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default JanusRtmpStreamer;\r\n"],"names":["_useState","useState","_useState2","_slicedToArray","janus","setJanus","_useState3","_useState4","rtmpPlugin","setRtmpPlugin","_useState5","_useState6","streaming","setStreaming","_useState7","_useState8","connected","setConnected","_useState9","_useState10","isWsConnected","setIsWsConnected","localVideoRef","useRef","ipRef","useEffect","current","WebSocket","onopen","console","log","onclose","onerror","error","close","Janus","init","debug","callback","janusInstance","server","success","attachRtmpPlugin","destroy","attach","plugin","pluginHandle","webrtcState","on","onmessage","msg","jsep","onlocalstream","stream","srcObject","_jsxs","className","children","_jsx","ref","autoPlay","muted","concat","onClick","publish","disabled","FaPlay","hangup","FaStop"],"sourceRoot":""}